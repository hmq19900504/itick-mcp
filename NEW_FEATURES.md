# 新增工具说明文档

## 📅 更新日期
2025年11月30日

## 🎉 新增功能

本次更新新增了 **2个强大的分析工具**，将项目从基础行情查询提升到专业技术分析水平。

---

## 🆕 新增工具列表

### 1. 技术指标分析工具 (`itick_technical_indicators`)

#### 📊 功能概述
基于K线数据计算多种技术指标，包括MACD、RSI、KDJ、BOLL、MA等常用技术分析指标。

#### 💡 支持的指标

| 指标 | 名称 | 参数 | 用途 |
|------|------|------|------|
| **MACD** | 指数平滑异同移动平均线 | (12,26,9) | 趋势跟踪，金叉/死叉信号 |
| **RSI** | 相对强弱指标 | 14期 | 超买超卖判断（>70超买，<30超卖） |
| **KDJ** | 随机指标 | (9,3,3) | 超买超卖（J>100超买，J<0超卖） |
| **BOLL** | 布林带 | 20期, 2倍标准差 | 波动率分析，支撑阻力 |
| **MA** | 移动平均线 | 5/10/20/60日 | 趋势判断，均线系统 |
| **EMA** | 指数移动平均线 | 可自定义 | 加权移动平均 |

#### 🔧 使用示例

```python
# 查询腾讯的MACD和RSI指标
{
    "region": "HK",
    "code": "700",
    "indicators": ["macd", "rsi"],
    "period": "day",
    "limit": 200
}

# 查询茅台的全部技术指标
{
    "region": "SH",
    "code": "600519",
    "indicators": ["all"],
    "period": "day",
    "limit": 200
}
```

#### 📈 输出示例

```
## 📊 技术指标分析

**股票信息**
- 📌 代码: HK.700
- 📈 周期: day
- 📅 数据量: 200 条K线
- 💰 最新价: 611.50

### MACD
- **dif**: 0.5419
- **dea**: 0.6837
- **macd**: -0.2836
- **signal**: 🔴 死叉(看空)

### RSI
- **rsi**: 50.0
- **status**: ➖ 中性区域
- **period**: 14
```

#### 💡 AI Agent 使用场景
- "计算腾讯的MACD和RSI指标"
- "分析茅台的KDJ超买超卖情况"
- "查看苹果的布林带和均线系统"
- "全面分析比亚迪的技术指标"

---

### 2. 资金流向分析工具 (`itick_money_flow`)

#### 📊 功能概述
基于成交量和价格变化分析资金流入流出情况，包括主力资金、大单、中单、小单的流向分布。

#### 💡 分析维度

| 资金类型 | 定义 | 作用 |
|---------|------|------|
| **🐋 超大单** | 单笔成交≥50万元 | 机构/大户资金动向 |
| **🐘 大单** | 单笔成交20-50万元 | 中大户资金动向 |
| **🐕 中单** | 单笔成交5-20万元 | 中户资金动向 |
| **🐁 小单** | 单笔成交<5万元 | 散户资金动向 |
| **💪 主力资金** | 超大单+大单 | 市场主导力量 |

#### 🔧 核心指标

- **净流入额**: 流入资金 - 流出资金
- **净流入占比**: 净流入 / 总成交额 × 100%
- **主力净占比**: 主力净流入 / 总成交额
- **资金强度**: 综合评估资金流向强度

#### 🎯 判断标准

| 主力净占比 | 资金强度 | 操作建议 |
|-----------|---------|---------|
| >10% | 🔥 主力强势流入(大幅吸筹) | 可考虑跟进 |
| 5%-10% | 📈 主力持续流入(稳步建仓) | 关注机会 |
| 0%-5% | ✅ 主力小幅流入(试探性买入) | 谨慎观望 |
| -5%-0% | ⚠️ 主力小幅流出(获利了结) | 注意风险 |
| -10%--5% | 📉 主力持续流出(减仓离场) | 建议减仓 |
| <-10% | 🔴 主力大幅流出(明显出货) | 尽快离场 |

#### 🔧 使用示例

```python
# 查询腾讯近10日资金流向
{
    "region": "HK",
    "code": "700",
    "period": "day",
    "days": 10
}

# 分析茅台近20日主力资金
{
    "region": "SH",
    "code": "600519",
    "period": "day",
    "days": 20
}
```

#### 📈 输出示例

```
## 💰 资金流向分析报告

**股票信息**
- 📌 代码: HK.700
- 📅 分析周期: day × 10天
- 💵 总成交额: ¥24.87亿

### 📊 资金流向汇总

**整体流向**
- 💹 净流入: ¥201857.32万 (+81.17%)
- 📈 总流入: ¥22.53亿
- 📉 总流出: ¥2.34亿

**主力资金** (超大单+大单)
- 🎯 主力净额: ¥111021.53万 (+44.64%)
- 💪 资金强度: 🔥 主力强势流入(大幅吸筹)

### 📈 分级资金流向

| 资金类型 | 流入金额 | 流出金额 | 净流入 | 净占比 |
|---------|---------|---------|--------|--------|
| 🐋 超大单 | ¥67582.76万 | ¥7025.56万 | ¥60557.20万 | +24.35% |
| 🐘 大单 | ¥56318.96万 | ¥5854.63万 | ¥50464.33万 | +20.29% |
```

#### 💡 AI Agent 使用场景
- "查看腾讯近期资金流向"
- "分析茅台主力资金动向"
- "查询苹果大单资金流入情况"
- "比较宁德时代和比亚迪的资金流向"

---

## 📊 工具总览

### 更新前（5个工具）
1. ✅ `itick_stock_quote` - 实时报价
2. ✅ `itick_stock_kline` - K线数据
3. ✅ `itick_stock_tick` - 逐笔成交
4. ✅ `itick_stock_depth` - 盘口深度
5. ✅ `itick_current_timestamp` - 当前时间

### 更新后（7个工具）
1. ✅ `itick_stock_quote` - 实时报价
2. ✅ `itick_stock_kline` - K线数据
3. ✅ `itick_stock_tick` - 逐笔成交
4. ✅ `itick_stock_depth` - 盘口深度
5. ✅ `itick_current_timestamp` - 当前时间
6. 🆕 `itick_technical_indicators` - **技术指标分析**
7. 🆕 `itick_money_flow` - **资金流向分析**

---

## 🎯 技术实现

### 技术指标计算
- 基于K线数据进行本地计算
- 支持自定义参数（周期、均线天数等）
- 实现了专业的技术分析算法
- 提供多指标组合分析

### 资金流向估算
- 基于价格涨跌和成交量推算
- 按成交额分类统计各级别资金
- 计算主力资金净流入占比
- 提供每日资金流向明细

---

## 📝 测试结果

### 测试覆盖
✅ 技术指标工具
  - MACD计算准确性 ✓
  - RSI超买超卖判断 ✓
  - KDJ指标计算 ✓
  - BOLL布林带 ✓
  - 均线系统 ✓
  - 多市场支持（港股、A股、美股）✓

✅ 资金流向工具
  - 资金分类统计 ✓
  - 主力资金识别 ✓
  - 净流入计算 ✓
  - 每日流向明细 ✓
  - 强度判断准确 ✓

### 测试数据
- **腾讯控股(700.HK)**: MACD死叉, RSI中性, 主力强势流入
- **贵州茅台(600519.SH)**: 全指标分析正常, 主力稳步建仓
- **苹果(AAPL)**: KDJ+BOLL正常, 资金小幅流出

---

## 🚀 使用方式

### 1. 重启MCP服务
```bash
python -m src.server
```

### 2. Claude Desktop配置
MCP服务会自动注册新工具，Claude可以直接使用：

```
请帮我分析腾讯控股的技术指标和资金流向
```

### 3. API调用示例
```json
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "itick_technical_indicators",
    "arguments": {
      "region": "HK",
      "code": "700",
      "indicators": ["macd", "rsi", "kdj"],
      "period": "day"
    }
  },
  "id": 1
}
```

---

## 📚 参考对比

### 与 finance-mcp 工具对比

| 功能 | finance-mcp | itick-mcp | 状态 |
|------|-------------|-----------|------|
| 实时报价 | ✅ | ✅ | 已实现 |
| K线数据 | ✅ | ✅ | 已实现 |
| 技术指标 | ✅ (indicators参数) | ✅ (独立工具) | 🆕已实现 |
| 资金流向 | ✅ (money_flow) | ✅ | 🆕已实现 |
| 大宗交易 | ✅ (block_trade) | ❌ | iTick API不支持 |
| 龙虎榜 | ✅ (dragon_tiger_inst) | ❌ | iTick API不支持 |
| 融资融券 | ✅ (margin_trade) | ❌ | iTick API不支持 |
| 公司财报 | ✅ (company_performance) | ❌ | iTick API不支持 |

### 未来可扩展功能
1. ⏳ 大宗交易数据（需要iTick API支持）
2. ⏳ 龙虎榜机构席位（需要iTick API支持）
3. ⏳ 融资融券数据（需要iTick API支持）
4. ⏳ 公司财报数据（需要iTick API支持）
5. ⏳ 板块分析工具
6. ⏳ 多股对比工具

---

## ⚠️ 注意事项

### 技术指标
1. 需要足够的K线数据（建议至少100条）
2. 指标计算基于历史数据，不保证未来表现
3. 建议多指标组合使用，提高准确性
4. 不同周期的指标可能给出不同信号

### 资金流向
1. 基于K线数据估算，非实时逐笔数据
2. 仅供参考，不构成投资建议
3. 短期资金流向可能受市场情绪影响
4. 建议关注中长期资金流向趋势

---

## 📞 技术支持

如有问题或建议，请提交 Issue 到：
https://github.com/hmq19900504/itick-mcp

---

**更新人**: GitHub Copilot  
**测试状态**: ✅ 全部通过  
**文档更新**: 2025-11-30
