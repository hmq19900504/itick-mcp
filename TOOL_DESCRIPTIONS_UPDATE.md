# 工具描述优化说明 (v1.2.1)

## 问题背景

用户反馈：当用户说"恒科跳水"时，Claude Agent 错误地使用了个股查询工具（`itick_stock_quote`）而不是指数分析工具（`itick_index_analysis`），导致查询失败或返回错误数据。

**根本原因**: 工具描述中没有明确区分个股、指数、板块的适用范围，导致 Agent 无法正确选择工具。

## 解决方案

### 1. 增加明确的适用范围说明

为所有 9 个工具添加了 **"⚠️ 重要提示 - 工具适用范围"** 部分，包括：
- ✅ **适用于**: 明确该工具应该用于什么对象
- ❌ **不适用于**: 明确该工具不应该用于什么对象，并指向正确的工具

### 2. 添加关键词识别指南

为 `itick_index_analysis` 添加了常见指数关键词识别列表：

```
🔍 **常见指数关键词识别**:
当用户提到以下词汇时，应该使用本工具：
- "恒科"、"恒指"、"恒生" → 恒生指数 (HSI.HK)
- "恒生科技"、"恒科指数" → 恒生科技指数 (HSTECH.HK)
- "上证"、"上证指数"、"沪指" → 上证指数 (000001.SH)
- "深证"、"深成指" → 深证成指 (399001.SZ)
- "创业板"、"创指" → 创业板指 (399006.SZ)
- "纳指"、"纳斯达克" → 纳斯达克 (IXIC)
- "标普"、"标普500" → 标普500 (SPX)
- "道指"、"道琼斯" → 道琼斯 (DJI)
```

### 3. 统一描述格式

所有工具描述遵循统一格式：
1. **工具功能简述** - 明确标注【个股】/【指数】/【板块】
2. **⚠️ 适用范围** - 清晰说明适用和不适用的场景
3. **关键词识别** (仅指数和板块工具)
4. **数据内容/分析维度**
5. **主要用途**
6. **使用建议**

## 更新的工具列表

### 个股工具 (6个)
| 工具名称 | 适用对象 | 示例 |
|---------|---------|------|
| `itick_stock_quote` | 个股实时报价 | "腾讯跳水"、"茅台大涨" |
| `itick_stock_kline` | 个股K线数据 | "比亚迪日K线"、"阿里月线" |
| `itick_stock_tick` | 个股逐笔成交 | "腾讯最新成交" |
| `itick_stock_depth` | 个股盘口深度 | "茅台买卖盘" |
| `itick_technical_indicators` | 个股技术指标 | "比亚迪MACD" |
| `itick_money_flow` | 个股资金流向 | "腾讯主力资金" |

### 指数工具 (1个)
| 工具名称 | 适用对象 | 示例 |
|---------|---------|------|
| `itick_index_analysis` | 大盘指数分析 | "恒科跳水"、"上证大跌"、"纳指暴涨" |

### 板块工具 (1个)
| 工具名称 | 适用对象 | 示例 |
|---------|---------|------|
| `itick_sector_analysis` | 行业板块分析 | "科技板块领跌"、"医药板块大涨" |

### 其他工具 (1个)
| 工具名称 | 说明 |
|---------|------|
| `itick_timestamp_format` | 时间戳格式转换工具 |

## 典型场景示例

### ✅ 正确场景 1: "恒科跳水"
- **用户意图**: 查询恒生科技指数下跌情况
- **应选工具**: `itick_index_analysis`
- **参数**: `{"symbols": ["HSTECH.HK"]}`

### ✅ 正确场景 2: "腾讯跳水"
- **用户意图**: 查询腾讯控股股价下跌情况
- **应选工具**: `itick_stock_quote`
- **参数**: `{"symbol": "700.HK"}`

### ✅ 正确场景 3: "科技板块领跌"
- **用户意图**: 查询科技板块整体表现
- **应选工具**: `itick_sector_analysis`
- **参数**: `{"sector_name": "科技"}`

### ❌ 错误场景: "恒科跳水" 使用个股工具
- **错误**: 使用 `itick_stock_quote` 查询 "恒科"
- **后果**: API 返回错误或找不到数据
- **原因**: "恒科" 是指数代码，不是个股代码

## 预期效果

1. **提高工具选择准确率**: Agent 能够根据用户输入的关键词正确识别应该使用哪个工具
2. **减少查询错误**: 避免使用错误的工具导致 API 错误或无数据返回
3. **提升用户体验**: 用户不需要明确说明是"个股"还是"指数"，Agent 能自动识别
4. **降低歧义**: 清晰的工具描述减少了 Agent 的困惑和重试次数

## 测试建议

### 测试用例 1: 指数查询
```
用户: "恒科跳水，什么情况？"
预期: 使用 itick_index_analysis，查询 HSTECH.HK
```

### 测试用例 2: 个股查询
```
用户: "腾讯跳水，主力在出逃吗？"
预期: 使用 itick_stock_quote 和 itick_money_flow，查询 700.HK
```

### 测试用例 3: 板块查询
```
用户: "科技板块今天表现怎么样？"
预期: 使用 itick_sector_analysis，分析科技板块
```

### 测试用例 4: 混合查询
```
用户: "恒指和腾讯今天都跌了吗？"
预期: 
- 使用 itick_index_analysis 查询恒生指数 (HSI.HK)
- 使用 itick_stock_quote 查询腾讯 (700.HK)
```

## 版本信息

- **更新版本**: v1.2.1
- **更新日期**: 2025-12-02
- **更新内容**: 优化工具描述，增加适用范围说明和关键词识别指南
- **影响范围**: 全部 9 个工具的描述文本

## 升级步骤

1. ✅ 更新所有工具的 description 字段
2. ✅ 重启 MCP 服务器
3. ⏳ 重启 Claude Desktop（用户操作）
4. ⏳ 测试验证

## 注意事项

⚠️ **用户需要完全重启 Claude Desktop** (Cmd+Q 后重新打开) 才能加载新的工具描述。

---

**Updated by**: GitHub Copilot  
**Date**: 2025-12-02
